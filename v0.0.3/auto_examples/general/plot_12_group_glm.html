
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Group Level GLM &#8212; MNE-NIRS 0.0.5 documentation</title>
    
  <link href="../../_static/css/theme.css" rel="stylesheet" />
  <link href="../../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/basic.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/bootstrap_divs.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/font-awesome.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/gallery.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/gallery-dataframe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/gallery-rendered-html.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/bootstrap_divs.js"></script>
    <script src="../../_static/js/copybutton.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Waveform averaging analysis" href="plot_15_waveform.html" />
    <link rel="prev" title="GLM Analysis (Measured)" href="plot_11_hrf_measured.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    
<a class="navbar-brand" href="../../index.html">
<p class="title">MNE-NIRS</p>
</a>

    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 current active nav-item">
 <a class="reference internal nav-link" href="../index.html">
  Examples
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../api.html">
  API
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <div class="dropdown">
    <button type="button" class="btn btn-primary btn-sm navbar-btn dropdown-toggle" id="dLabelMore" data-toggle="dropdown">
        v0.0.5
        <span class="caret"></span>
    </button>
    <div class="dropdown-menu list-group-flush py-0" aria-labelledby="dLabelMore">
            <a class="list-group-item list-group-item-action py-1" href=../../../master/index.html>master</a>
            <a class="list-group-item list-group-item-action py-1" href="https://mne.tools/mne-nirs/v0.0.5/index.html">v0.0.5 (stable)</a>
            <a class="list-group-item list-group-item-action py-1" href="https://mne.tools/mne-nirs/v0.0.4/index.html">v0.0.4</a>
            <a class="list-group-item list-group-item-action py-1" href="https://mne.tools/mne-nirs/v0.0.3/index.html">v0.0.3</a>
            <a class="list-group-item list-group-item-action py-1" href="https://mne.tools/mne-nirs/v0.0.2/index.html">v0.0.2</a>
    </div>
</div>
      </div>
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/mne-tools/mne-nirs" rel="noopener" target="_blank" title="GitHub">
            <span><i class="fab fa-github-square"></i></span>
            <label class="sr-only">GitHub</label>
          </a>
        </li>
      </ul>
      </div>
      
      <div class="navbar-end-item">
        <form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <div class="col-12 col-md-1 col-xl-2 bd-sidebar no-sidebar"></div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
              
              <div class="toc-item">
                
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#define-individual-analysis">
   Define individual analysis
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#run-analysis-on-all-participants">
   Run analysis on all participants
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#visualise-individual-results">
   Visualise Individual results
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#compute-group-level-results">
   Compute group level results
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#visualise-group-results">
   Visualise group results
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#group-topographic-visualisation">
   Group topographic visualisation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#contrasts">
   Contrasts
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#table-of-channel-level-results">
   Table of channel level results
  </a>
 </li>
</ul>

</nav>
              </div>
              
              <div class="toc-item">
                
              </div>
              
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-11 col-xl-8 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                

<p>
  <strong>
    <p style="border:3px; border-style:solid; border-color:#FF0000; padding: 1em;">
    
    You are reading a version (v0.0.3) of the documentation associated with a release.
    Releases provide a snapshot of the software from a specific instance in time,
    allowing you to always revert to a working version of the code.
    Releases are created at instances when the code is considered stable and feature complete.
    Whereas, the master branch contains the latest features and newest version of the code.
    To view the latest up-to-date documentation for this project,
    please have a look at <a href="../../../master/index.html">master</a>.
    
    </p>
  </strong>
</p>


  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p>Click <a class="reference internal" href="#sphx-glr-download-auto-examples-general-plot-12-group-glm-py"><span class="std std-ref">here</span></a>
to download the full example code</p>
</div>
<div class="sphx-glr-example-title section" id="group-level-glm">
<span id="tut-fnirs-group"></span><span id="sphx-glr-auto-examples-general-plot-12-group-glm-py"></span><h1>Group Level GLM<a class="headerlink" href="#group-level-glm" title="Permalink to this headline">¶</a></h1>
<p>This is an example of a group level GLM based
functional near-infrared spectroscopy (fNIRS)
analysis in MNE-NIRS.</p>
<div class="sidebar">
<p class="sidebar-title">Relevant literature</p>
<p>Gorgolewski, Krzysztof J., et al.
“The brain imaging data structure, a format for organizing and describing
outputs of neuroimaging experiments.” Scientific data 3.1 (2016): 1-9.</p>
<p>Santosa, H., Zhai, X., Fishburn, F., &amp; Huppert, T. (2018).
The NIRS brain AnalyzIR toolbox. Algorithms, 11(5), 73.</p>
</div>
<p>Individual level analysis of this data is described in the
<a class="reference external" href="https://mne.tools/stable/auto_tutorials/preprocessing/70_fnirs_processing.html#tut-fnirs-processing" title="(in MNE v0.23.0)"><span class="xref std std-ref">MNE fNIRS waveform tutorial</span></a>
and the
<a class="reference internal" href="plot_11_hrf_measured.html#tut-fnirs-hrf"><span class="std std-ref">MNE-NIRS fNIRS GLM tutorial</span></a>
So this example will skim over the individual level details
and focus on the group level aspect of analysis.
Here we describe how to process multiple measurements
and summarise  group level effects both as summary statistics and visually.</p>
<p>The data used in this example is available
<a class="reference external" href="https://github.com/rob-luke/BIDS-NIRS-Tapping">at this location</a>.
It is a finger tapping example and is briefly described below.
The dataset contains 5 participants.
The example dataset is in
<a class="reference external" href="https://bids.neuroimaging.io">BIDS</a>
format and therefore already contains
information about triggers, condition names, etc.
The BIDS specification for NIRS data is still under development,
as such you must use the development branch of MNE-BIDS as listed in the
requirements_doc.txt file to run this example.</p>
<div class="panel panel-success">
<div class="panel-heading"><h4 class="panel-title">
<a data-toggle="collapse" href="#collapse_chevron-circle-down-data-description-click-to-expand"><em class="fa fa-chevron-circle-down"></em> Data description (click to expand)</a></h4></div>
<div id="collapse_chevron-circle-down-data-description-click-to-expand" class="panel-collapse collapse">
<div class="panel-body"><p>Optodes were placed over the motor cortex using the standard NIRX motor
montage, but with 8 short channels added (see their web page for details).
To view the sensor locations run
<cite>raw_intensity.plot_sensors()</cite>.
A sound was presented to indicate which hand the participant should tap.
Participants tapped their thumb to their fingers for 5s.
Conditions were presented in a random order with a randomised inter
stimulus interval.</p>
</div></div></div><div class="contents local topic" id="page-contents">
<p class="topic-title">Page contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#define-individual-analysis" id="id1">Define individual analysis</a></p></li>
<li><p><a class="reference internal" href="#run-analysis-on-all-participants" id="id2">Run analysis on all participants</a></p></li>
<li><p><a class="reference internal" href="#visualise-individual-results" id="id3">Visualise Individual results</a></p></li>
<li><p><a class="reference internal" href="#compute-group-level-results" id="id4">Compute group level results</a></p></li>
<li><p><a class="reference internal" href="#visualise-group-results" id="id5">Visualise group results</a></p></li>
<li><p><a class="reference internal" href="#group-topographic-visualisation" id="id6">Group topographic visualisation</a></p></li>
<li><p><a class="reference internal" href="#contrasts" id="id7">Contrasts</a></p></li>
<li><p><a class="reference internal" href="#table-of-channel-level-results" id="id8">Table of channel level results</a></p></li>
</ul>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># sphinx_gallery_thumbnail_number = 2</span>

<span class="c1"># Authors: Robert Luke &lt;mail@robertluke.net&gt;</span>
<span class="c1">#</span>
<span class="c1"># License: BSD (3-clause)</span>


<span class="c1"># Import common libraries</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="c1"># Import MNE processing</span>
<span class="kn">from</span> <span class="nn">mne.preprocessing.nirs</span> <span class="kn">import</span> <a href="https://mne.tools/stable/generated/mne.preprocessing.nirs.optical_density.html#mne.preprocessing.nirs.optical_density" title="mne.preprocessing.nirs.optical_density" class="sphx-glr-backref-module-mne-preprocessing-nirs sphx-glr-backref-type-py-function"><span class="n">optical_density</span></a><span class="p">,</span> <a href="https://mne.tools/stable/generated/mne.preprocessing.nirs.beer_lambert_law.html#mne.preprocessing.nirs.beer_lambert_law" title="mne.preprocessing.nirs.beer_lambert_law" class="sphx-glr-backref-module-mne-preprocessing-nirs sphx-glr-backref-type-py-function"><span class="n">beer_lambert_law</span></a>

<span class="c1"># Import MNE-NIRS processing</span>
<span class="kn">from</span> <span class="nn">mne_nirs.statistics</span> <span class="kn">import</span> <a href="../../generated/mne_nirs.statistics.run_GLM.html#mne_nirs.statistics.run_GLM" title="mne_nirs.statistics.run_GLM" class="sphx-glr-backref-module-mne_nirs-statistics sphx-glr-backref-type-py-function"><span class="n">run_GLM</span></a>
<span class="kn">from</span> <span class="nn">mne_nirs.experimental_design</span> <span class="kn">import</span> <a href="../../generated/mne_nirs.experimental_design.make_first_level_design_matrix.html#mne_nirs.experimental_design.make_first_level_design_matrix" title="mne_nirs.experimental_design.make_first_level_design_matrix" class="sphx-glr-backref-module-mne_nirs-experimental_design sphx-glr-backref-type-py-function"><span class="n">make_first_level_design_matrix</span></a>
<span class="kn">from</span> <span class="nn">mne_nirs.statistics</span> <span class="kn">import</span> <a href="../../generated/mne_nirs.statistics.glm_region_of_interest.html#mne_nirs.statistics.glm_region_of_interest" title="mne_nirs.statistics.glm_region_of_interest" class="sphx-glr-backref-module-mne_nirs-statistics sphx-glr-backref-type-py-function"><span class="n">glm_region_of_interest</span></a><span class="p">,</span> <a href="../../generated/mne_nirs.statistics.statsmodels_to_results.html#mne_nirs.statistics.statsmodels_to_results" title="mne_nirs.statistics.statsmodels_to_results" class="sphx-glr-backref-module-mne_nirs-statistics sphx-glr-backref-type-py-function"><span class="n">statsmodels_to_results</span></a>
<span class="kn">from</span> <span class="nn">mne_nirs.statistics</span> <span class="kn">import</span> <a href="../../generated/mne_nirs.statistics.compute_contrast.html#mne_nirs.statistics.compute_contrast" title="mne_nirs.statistics.compute_contrast" class="sphx-glr-backref-module-mne_nirs-statistics sphx-glr-backref-type-py-function"><span class="n">compute_contrast</span></a>
<span class="kn">from</span> <span class="nn">mne_nirs.channels</span> <span class="kn">import</span> <a href="../../generated/mne_nirs.channels.get_short_channels.html#mne_nirs.channels.get_short_channels" title="mne_nirs.channels.get_short_channels" class="sphx-glr-backref-module-mne_nirs-channels sphx-glr-backref-type-py-function"><span class="n">get_short_channels</span></a><span class="p">,</span> <a href="../../generated/mne_nirs.channels.get_long_channels.html#mne_nirs.channels.get_long_channels" title="mne_nirs.channels.get_long_channels" class="sphx-glr-backref-module-mne_nirs-channels sphx-glr-backref-type-py-function"><span class="n">get_long_channels</span></a>
<span class="kn">from</span> <span class="nn">mne_nirs.channels</span> <span class="kn">import</span> <a href="../../generated/mne_nirs.channels.picks_pair_to_idx.html#mne_nirs.channels.picks_pair_to_idx" title="mne_nirs.channels.picks_pair_to_idx" class="sphx-glr-backref-module-mne_nirs-channels sphx-glr-backref-type-py-function"><span class="n">picks_pair_to_idx</span></a>
<span class="kn">from</span> <span class="nn">mne_nirs.utils._io</span> <span class="kn">import</span> <a href="../../generated/mne_nirs.utils.glm_to_tidy.html#mne_nirs.utils.glm_to_tidy" title="mne_nirs.utils.glm_to_tidy" class="sphx-glr-backref-module-mne_nirs-utils sphx-glr-backref-type-py-function"><span class="n">glm_to_tidy</span></a>
<span class="kn">from</span> <span class="nn">mne_nirs.visualisation</span> <span class="kn">import</span> <a href="../../generated/mne_nirs.visualisation.plot_glm_group_topo.html#mne_nirs.visualisation.plot_glm_group_topo" title="mne_nirs.visualisation.plot_glm_group_topo" class="sphx-glr-backref-module-mne_nirs-visualisation sphx-glr-backref-type-py-function"><span class="n">plot_glm_group_topo</span></a>
<span class="kn">from</span> <span class="nn">mne_nirs.datasets</span> <span class="kn">import</span> <span class="n">fnirs_motor_group</span>

<span class="c1"># Import MNE-BIDS processing</span>
<span class="kn">from</span> <span class="nn">mne_bids</span> <span class="kn">import</span> <a href="https://mne.tools/mne-bids/stable/generated/mne_bids.BIDSPath.html#mne_bids.BIDSPath" title="mne_bids.BIDSPath" class="sphx-glr-backref-module-mne_bids sphx-glr-backref-type-py-class"><span class="n">BIDSPath</span></a><span class="p">,</span> <a href="https://mne.tools/mne-bids/stable/generated/mne_bids.read_raw_bids.html#mne_bids.read_raw_bids" title="mne_bids.read_raw_bids" class="sphx-glr-backref-module-mne_bids sphx-glr-backref-type-py-function"><span class="n">read_raw_bids</span></a>

<span class="c1"># Import StatsModels</span>
<span class="kn">import</span> <span class="nn">statsmodels.formula.api</span> <span class="k">as</span> <span class="nn">smf</span>

<span class="c1"># Import Plotting Library</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="kn">from</span> <span class="nn">lets_plot</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">LetsPlot</span><span class="o">.</span><span class="n">setup_html</span><span class="p">()</span>
</pre></div>
</div>
<div class="section" id="define-individual-analysis">
<h2><a class="toc-backref" href="#id1">Define individual analysis</a><a class="headerlink" href="#define-individual-analysis" title="Permalink to this headline">¶</a></h2>
<div class="sidebar">
<p class="sidebar-title">Individual analysis procedures</p>
<p>Waveform individual analysis:
<a class="reference external" href="https://mne.tools/stable/auto_tutorials/preprocessing/70_fnirs_processing.html#tut-fnirs-processing" title="(in MNE v0.23.0)"><span class="xref std std-ref">MNE docs</span></a></p>
<p>GLM individual analysis:
<a class="reference internal" href="plot_11_hrf_measured.html#tut-fnirs-hrf"><span class="std std-ref">MNE-NIRS docs</span></a></p>
</div>
<p>First we define the analysis that will be applied to each file.
This is a GLM analysis as described in the
<a class="reference internal" href="plot_11_hrf_measured.html#tut-fnirs-hrf"><span class="std std-ref">individual GLM tutorial</span></a>,
so this example will skim over the individual level details.</p>
<p>The analysis extracts a response estimate for each channel,
each region of interest, and computes a contrast between left and right
finger tapping.
We return the raw object and data frames for the computed results.
Information about channels, triggers and their meanings are stored in the
BIDS structure and are automatically obtained when importing the data.</p>
<p>Here we also resample to a 0.3 Hz sample rate just to speed up the example
and use less memory, resampling to 0.6 Hz is a better choice for full
analyses.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">individual_analysis</span><span class="p">(</span><a href="https://mne.tools/mne-bids/stable/generated/mne_bids.BIDSPath.html#mne_bids.BIDSPath" title="mne_bids.BIDSPath" class="sphx-glr-backref-module-mne_bids sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">bids_path</span></a><span class="p">,</span> <a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ID</span></a><span class="p">):</span>

    <span class="n">raw_intensity</span> <span class="o">=</span> <a href="https://mne.tools/mne-bids/stable/generated/mne_bids.read_raw_bids.html#mne_bids.read_raw_bids" title="mne_bids.read_raw_bids" class="sphx-glr-backref-module-mne_bids sphx-glr-backref-type-py-function"><span class="n">read_raw_bids</span></a><span class="p">(</span><a href="https://mne.tools/mne-bids/stable/generated/mne_bids.BIDSPath.html#mne_bids.BIDSPath" title="mne_bids.BIDSPath" class="sphx-glr-backref-module-mne_bids sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">bids_path</span></a><span class="o">=</span><a href="https://mne.tools/mne-bids/stable/generated/mne_bids.BIDSPath.html#mne_bids.BIDSPath" title="mne_bids.BIDSPath" class="sphx-glr-backref-module-mne_bids sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">bids_path</span></a><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># Convert signal to haemoglobin and resample</span>
    <span class="n">raw_od</span> <span class="o">=</span> <a href="https://mne.tools/stable/generated/mne.preprocessing.nirs.optical_density.html#mne.preprocessing.nirs.optical_density" title="mne.preprocessing.nirs.optical_density" class="sphx-glr-backref-module-mne-preprocessing-nirs sphx-glr-backref-type-py-function"><span class="n">optical_density</span></a><span class="p">(</span><span class="n">raw_intensity</span><span class="p">)</span>
    <span class="n">raw_haemo</span> <span class="o">=</span> <a href="https://mne.tools/stable/generated/mne.preprocessing.nirs.beer_lambert_law.html#mne.preprocessing.nirs.beer_lambert_law" title="mne.preprocessing.nirs.beer_lambert_law" class="sphx-glr-backref-module-mne-preprocessing-nirs sphx-glr-backref-type-py-function"><span class="n">beer_lambert_law</span></a><span class="p">(</span><span class="n">raw_od</span><span class="p">)</span>
    <a href="https://mne.tools/stable/generated/mne.io.BaseRaw.html#mne.io.BaseRaw.resample" title="mne.io.BaseRaw.resample" class="sphx-glr-backref-module-mne-io sphx-glr-backref-type-py-method"><span class="n">raw_haemo</span><span class="o">.</span><span class="n">resample</span></a><span class="p">(</span><span class="mf">0.3</span><span class="p">)</span>

    <span class="c1"># Cut out just the short channels for creating a GLM repressor</span>
    <span class="n">sht_chans</span> <span class="o">=</span> <a href="../../generated/mne_nirs.channels.get_short_channels.html#mne_nirs.channels.get_short_channels" title="mne_nirs.channels.get_short_channels" class="sphx-glr-backref-module-mne_nirs-channels sphx-glr-backref-type-py-function"><span class="n">get_short_channels</span></a><span class="p">(</span><span class="n">raw_haemo</span><span class="p">)</span>
    <span class="n">raw_haemo</span> <span class="o">=</span> <a href="../../generated/mne_nirs.channels.get_long_channels.html#mne_nirs.channels.get_long_channels" title="mne_nirs.channels.get_long_channels" class="sphx-glr-backref-module-mne_nirs-channels sphx-glr-backref-type-py-function"><span class="n">get_long_channels</span></a><span class="p">(</span><span class="n">raw_haemo</span><span class="p">)</span>

    <span class="c1"># Create a design matrix</span>
    <span class="n">design_matrix</span> <span class="o">=</span> <a href="../../generated/mne_nirs.experimental_design.make_first_level_design_matrix.html#mne_nirs.experimental_design.make_first_level_design_matrix" title="mne_nirs.experimental_design.make_first_level_design_matrix" class="sphx-glr-backref-module-mne_nirs-experimental_design sphx-glr-backref-type-py-function"><span class="n">make_first_level_design_matrix</span></a><span class="p">(</span><span class="n">raw_haemo</span><span class="p">,</span> <span class="n">stim_dur</span><span class="o">=</span><span class="mf">5.0</span><span class="p">)</span>

    <span class="c1"># Append short channels mean to design matrix</span>
    <span class="n">design_matrix</span><span class="p">[</span><span class="s2">&quot;ShortHbO&quot;</span><span class="p">]</span> <span class="o">=</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.mean.html#numpy.mean" title="numpy.mean" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">mean</span></a><span class="p">(</span><span class="n">sht_chans</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">pick</span><span class="p">(</span><span class="n">picks</span><span class="o">=</span><span class="s2">&quot;hbo&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get_data</span><span class="p">(),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">design_matrix</span><span class="p">[</span><span class="s2">&quot;ShortHbR&quot;</span><span class="p">]</span> <span class="o">=</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.mean.html#numpy.mean" title="numpy.mean" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">mean</span></a><span class="p">(</span><span class="n">sht_chans</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">pick</span><span class="p">(</span><span class="n">picks</span><span class="o">=</span><span class="s2">&quot;hbr&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get_data</span><span class="p">(),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># Run GLM</span>
    <span class="n">glm_est</span> <span class="o">=</span> <a href="../../generated/mne_nirs.statistics.run_GLM.html#mne_nirs.statistics.run_GLM" title="mne_nirs.statistics.run_GLM" class="sphx-glr-backref-module-mne_nirs-statistics sphx-glr-backref-type-py-function"><span class="n">run_GLM</span></a><span class="p">(</span><span class="n">raw_haemo</span><span class="p">,</span> <span class="n">design_matrix</span><span class="p">)</span>

    <span class="c1"># Define channels in each region of interest</span>
    <span class="c1"># List the channel pairs manually</span>
    <span class="n">left</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]</span>
    <span class="n">right</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">],</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">],</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">],</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">],</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">]]</span>
    <span class="c1"># Then generate the correct indices for each pair</span>
    <span class="n">groups</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="n">Left_Hemisphere</span><span class="o">=</span><a href="../../generated/mne_nirs.channels.picks_pair_to_idx.html#mne_nirs.channels.picks_pair_to_idx" title="mne_nirs.channels.picks_pair_to_idx" class="sphx-glr-backref-module-mne_nirs-channels sphx-glr-backref-type-py-function"><span class="n">picks_pair_to_idx</span></a><span class="p">(</span><span class="n">raw_haemo</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">on_missing</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">),</span>
        <span class="n">Right_Hemisphere</span><span class="o">=</span><a href="../../generated/mne_nirs.channels.picks_pair_to_idx.html#mne_nirs.channels.picks_pair_to_idx" title="mne_nirs.channels.picks_pair_to_idx" class="sphx-glr-backref-module-mne_nirs-channels sphx-glr-backref-type-py-function"><span class="n">picks_pair_to_idx</span></a><span class="p">(</span><span class="n">raw_haemo</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">on_missing</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">))</span>

    <span class="c1"># Extract channel metrics</span>
    <span class="n">cha</span> <span class="o">=</span> <a href="../../generated/mne_nirs.utils.glm_to_tidy.html#mne_nirs.utils.glm_to_tidy" title="mne_nirs.utils.glm_to_tidy" class="sphx-glr-backref-module-mne_nirs-utils sphx-glr-backref-type-py-function"><span class="n">glm_to_tidy</span></a><span class="p">(</span><span class="n">raw_haemo</span><span class="p">,</span> <span class="n">glm_est</span><span class="p">,</span> <span class="n">design_matrix</span><span class="p">)</span>
    <span class="n">cha</span><span class="p">[</span><span class="s2">&quot;ID&quot;</span><span class="p">]</span> <span class="o">=</span> <a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ID</span></a>  <span class="c1"># Add the participant ID to the dataframe</span>

    <span class="c1"># Compute region of interest results from channel data</span>
    <span class="n">roi</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">design_matrix</span><span class="o">.</span><span class="n">columns</span><span class="p">):</span>
        <span class="n">roi</span> <span class="o">=</span> <span class="n">roi</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><a href="../../generated/mne_nirs.statistics.glm_region_of_interest.html#mne_nirs.statistics.glm_region_of_interest" title="mne_nirs.statistics.glm_region_of_interest" class="sphx-glr-backref-module-mne_nirs-statistics sphx-glr-backref-type-py-function"><span class="n">glm_region_of_interest</span></a><span class="p">(</span><span class="n">glm_est</span><span class="p">,</span> <span class="n">groups</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">col</span><span class="p">))</span>
    <span class="n">roi</span><span class="p">[</span><span class="s2">&quot;ID&quot;</span><span class="p">]</span> <span class="o">=</span> <a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ID</span></a>  <span class="c1"># Add the participant ID to the dataframe</span>

    <span class="c1"># Contrast left vs right tapping</span>
    <span class="n">contrast_matrix</span> <span class="o">=</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.eye.html#numpy.eye" title="numpy.eye" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">eye</span></a><span class="p">(</span><span class="n">design_matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">basic_conts</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">column</span><span class="p">,</span> <span class="n">contrast_matrix</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">column</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">design_matrix</span><span class="o">.</span><span class="n">columns</span><span class="p">)])</span>
    <span class="n">contrast_LvR</span> <span class="o">=</span> <span class="n">basic_conts</span><span class="p">[</span><span class="s1">&#39;Tapping/Left&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">basic_conts</span><span class="p">[</span><span class="s1">&#39;Tapping/Right&#39;</span><span class="p">]</span>
    <span class="n">contrast</span> <span class="o">=</span> <a href="../../generated/mne_nirs.statistics.compute_contrast.html#mne_nirs.statistics.compute_contrast" title="mne_nirs.statistics.compute_contrast" class="sphx-glr-backref-module-mne_nirs-statistics sphx-glr-backref-type-py-function"><span class="n">compute_contrast</span></a><span class="p">(</span><span class="n">glm_est</span><span class="p">,</span> <span class="n">contrast_LvR</span><span class="p">)</span>
    <span class="n">con</span> <span class="o">=</span> <a href="../../generated/mne_nirs.utils.glm_to_tidy.html#mne_nirs.utils.glm_to_tidy" title="mne_nirs.utils.glm_to_tidy" class="sphx-glr-backref-module-mne_nirs-utils sphx-glr-backref-type-py-function"><span class="n">glm_to_tidy</span></a><span class="p">(</span><span class="n">raw_haemo</span><span class="p">,</span> <span class="n">contrast</span><span class="p">,</span> <span class="n">design_matrix</span><span class="p">)</span>
    <span class="n">con</span><span class="p">[</span><span class="s2">&quot;ID&quot;</span><span class="p">]</span> <span class="o">=</span> <a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ID</span></a>  <span class="c1"># Add the participant ID to the dataframe</span>

    <span class="c1"># Convert to uM for nicer plotting below.</span>
    <span class="n">cha</span><span class="p">[</span><span class="s2">&quot;theta&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span> <span class="o">*</span> <span class="mf">1.e6</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">cha</span><span class="p">[</span><span class="s2">&quot;theta&quot;</span><span class="p">]]</span>
    <span class="n">roi</span><span class="p">[</span><span class="s2">&quot;theta&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span> <span class="o">*</span> <span class="mf">1.e6</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">roi</span><span class="p">[</span><span class="s2">&quot;theta&quot;</span><span class="p">]]</span>
    <span class="n">con</span><span class="p">[</span><span class="s2">&quot;effect&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span> <span class="o">*</span> <span class="mf">1.e6</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">con</span><span class="p">[</span><span class="s2">&quot;effect&quot;</span><span class="p">]]</span>

    <span class="k">return</span> <span class="n">raw_haemo</span><span class="p">,</span> <span class="n">roi</span><span class="p">,</span> <span class="n">cha</span><span class="p">,</span> <span class="n">con</span>
</pre></div>
</div>
</div>
<div class="section" id="run-analysis-on-all-participants">
<h2><a class="toc-backref" href="#id2">Run analysis on all participants</a><a class="headerlink" href="#run-analysis-on-all-participants" title="Permalink to this headline">¶</a></h2>
<p>Next we loop through the five measurements and run the individual analysis
on each. We append the individual results in to a large dataframe that
will contain the results from all measurements. We create a group dataframe
for the region of interest, channel level, and contrast results.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df_roi</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>  <span class="c1"># To store region of interest results</span>
<span class="n">df_cha</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>  <span class="c1"># To store channel level results</span>
<span class="n">df_con</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>  <span class="c1"># To store channel level contrast results</span>

<span class="k">for</span> <a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">sub</span></a> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">):</span>  <span class="c1"># Loop from first to fifth subject</span>
    <a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ID</span></a> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%02d</span><span class="s1">&#39;</span> <span class="o">%</span> <a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">sub</span></a>  <span class="c1"># Tidy the subject name</span>

    <span class="c1"># Create path to file based on experiment info</span>
    <a href="https://mne.tools/mne-bids/stable/generated/mne_bids.BIDSPath.html#mne_bids.BIDSPath" title="mne_bids.BIDSPath" class="sphx-glr-backref-module-mne_bids sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">bids_path</span></a> <span class="o">=</span> <a href="https://mne.tools/mne-bids/stable/generated/mne_bids.BIDSPath.html#mne_bids.BIDSPath" title="mne_bids.BIDSPath" class="sphx-glr-backref-module-mne_bids sphx-glr-backref-type-py-class"><span class="n">BIDSPath</span></a><span class="p">(</span><span class="n">subject</span><span class="o">=</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ID</span></a><span class="p">,</span> <span class="n">task</span><span class="o">=</span><span class="s2">&quot;tapping&quot;</span><span class="p">,</span>
                         <span class="n">root</span><span class="o">=</span><span class="n">fnirs_motor_group</span><span class="o">.</span><span class="n">data_path</span><span class="p">(),</span>
                         <span class="n">datatype</span><span class="o">=</span><span class="s2">&quot;nirs&quot;</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;nirs&quot;</span><span class="p">,</span> <span class="n">extension</span><span class="o">=</span><span class="s2">&quot;.snirf&quot;</span><span class="p">)</span>

    <span class="c1"># Analyse data and return both ROI and channel results</span>
    <span class="n">raw_haemo</span><span class="p">,</span> <span class="n">roi</span><span class="p">,</span> <span class="n">channel</span><span class="p">,</span> <span class="n">con</span> <span class="o">=</span> <span class="n">individual_analysis</span><span class="p">(</span><a href="https://mne.tools/mne-bids/stable/generated/mne_bids.BIDSPath.html#mne_bids.BIDSPath" title="mne_bids.BIDSPath" class="sphx-glr-backref-module-mne_bids sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">bids_path</span></a><span class="p">,</span> <a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ID</span></a><span class="p">)</span>

    <span class="c1"># Append individual results to all participants</span>
    <span class="n">df_roi</span> <span class="o">=</span> <span class="n">df_roi</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">roi</span><span class="p">)</span>
    <span class="n">df_cha</span> <span class="o">=</span> <span class="n">df_cha</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">channel</span><span class="p">)</span>
    <span class="n">df_con</span> <span class="o">=</span> <span class="n">df_con</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">con</span><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Loading /home/runner/mne_data/MNE-fNIRS-motor-group-data/sub-01/nirs/sub-01_task-tapping_nirs.snirf
Reading events from /home/runner/mne_data/MNE-fNIRS-motor-group-data/sub-01/nirs/sub-01_task-tapping_events.tsv.
Reading channel info from /home/runner/mne_data/MNE-fNIRS-motor-group-data/sub-01/nirs/sub-01_task-tapping_channels.tsv.
Reading 0 ... 23238  =      0.000 ...  2974.464 secs...
Loading /home/runner/mne_data/MNE-fNIRS-motor-group-data/sub-02/nirs/sub-02_task-tapping_nirs.snirf
Reading events from /home/runner/mne_data/MNE-fNIRS-motor-group-data/sub-02/nirs/sub-02_task-tapping_events.tsv.
Reading channel info from /home/runner/mne_data/MNE-fNIRS-motor-group-data/sub-02/nirs/sub-02_task-tapping_channels.tsv.
Reading 0 ... 18877  =      0.000 ...  2416.256 secs...
Loading /home/runner/mne_data/MNE-fNIRS-motor-group-data/sub-03/nirs/sub-03_task-tapping_nirs.snirf
Reading events from /home/runner/mne_data/MNE-fNIRS-motor-group-data/sub-03/nirs/sub-03_task-tapping_events.tsv.
Reading channel info from /home/runner/mne_data/MNE-fNIRS-motor-group-data/sub-03/nirs/sub-03_task-tapping_channels.tsv.
Reading 0 ... 18874  =      0.000 ...  2415.872 secs...
Loading /home/runner/mne_data/MNE-fNIRS-motor-group-data/sub-04/nirs/sub-04_task-tapping_nirs.snirf
Reading events from /home/runner/mne_data/MNE-fNIRS-motor-group-data/sub-04/nirs/sub-04_task-tapping_events.tsv.
Reading channel info from /home/runner/mne_data/MNE-fNIRS-motor-group-data/sub-04/nirs/sub-04_task-tapping_channels.tsv.
Reading 0 ... 23120  =      0.000 ...  2959.360 secs...
Loading /home/runner/mne_data/MNE-fNIRS-motor-group-data/sub-05/nirs/sub-05_task-tapping_nirs.snirf
Reading events from /home/runner/mne_data/MNE-fNIRS-motor-group-data/sub-05/nirs/sub-05_task-tapping_events.tsv.
Reading channel info from /home/runner/mne_data/MNE-fNIRS-motor-group-data/sub-05/nirs/sub-05_task-tapping_channels.tsv.
Reading 0 ... 23006  =      0.000 ...  2944.768 secs...
</pre></div>
</div>
</div>
<div class="section" id="visualise-individual-results">
<h2><a class="toc-backref" href="#id3">Visualise Individual results</a><a class="headerlink" href="#visualise-individual-results" title="Permalink to this headline">¶</a></h2>
<p>First we visualise the results from each individual to ensure the
data values look reasonable.
Here we see that we have data from five participants, we plot just the HbO
values and observe they are in the expect range.
We can already see that the control condition is always near zero,
and that the responses look to be contralateral to the tapping hand.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">grp_results</span> <span class="o">=</span> <span class="n">df_roi</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;Condition in [&#39;Control&#39;, &#39;Tapping/Left&#39;, &#39;Tapping/Right&#39;]&quot;</span><span class="p">)</span>
<span class="n">grp_results</span> <span class="o">=</span> <span class="n">grp_results</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;Chroma in [&#39;hbo&#39;]&quot;</span><span class="p">)</span>

<span class="n">ggplot</span><span class="p">(</span><span class="n">grp_results</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;Condition&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;theta&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;ROI&#39;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="s1">&#39;ROI&#39;</span><span class="p">))</span> \
    <span class="o">+</span> <span class="n">geom_hline</span><span class="p">(</span><span class="n">y_intercept</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">linetype</span><span class="o">=</span><span class="s2">&quot;dashed&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> \
    <span class="o">+</span> <span class="n">geom_point</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span> \
    <span class="o">+</span> <span class="n">facet_grid</span><span class="p">(</span><span class="s1">&#39;ID&#39;</span><span class="p">)</span> \
    <span class="o">+</span> <span class="n">ggsize</span><span class="p">(</span><span class="mi">800</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span>
</pre></div>
</div>
<div class="output_subarea output_html rendered_html output_result">
<html lang="en">
   <head>
       <script type="text/javascript" data-lets-plot-script="library" src="https://cdn.jsdelivr.net/gh/JetBrains/lets-plot@v2.0.4/js-package/distr/lets-plot.min.js"></script>
   </head>
   <body>
          <div id="QIpxym"></div>
   <script type="text/javascript" data-lets-plot-script="plot">
       var plotSpec={
"data":{
"ROI":["Left_Hemisphere","Right_Hemisphere","Left_Hemisphere","Right_Hemisphere","Left_Hemisphere","Right_Hemisphere","Left_Hemisphere","Right_Hemisphere","Left_Hemisphere","Right_Hemisphere","Left_Hemisphere","Right_Hemisphere","Left_Hemisphere","Right_Hemisphere","Left_Hemisphere","Right_Hemisphere","Left_Hemisphere","Right_Hemisphere","Left_Hemisphere","Right_Hemisphere","Left_Hemisphere","Right_Hemisphere","Left_Hemisphere","Right_Hemisphere","Left_Hemisphere","Right_Hemisphere","Left_Hemisphere","Right_Hemisphere","Left_Hemisphere","Right_Hemisphere"],
"Condition":["Control","Control","Tapping/Left","Tapping/Left","Tapping/Right","Tapping/Right","Control","Control","Tapping/Left","Tapping/Left","Tapping/Right","Tapping/Right","Control","Control","Tapping/Left","Tapping/Left","Tapping/Right","Tapping/Right","Control","Control","Tapping/Left","Tapping/Left","Tapping/Right","Tapping/Right","Control","Control","Tapping/Left","Tapping/Left","Tapping/Right","Tapping/Right"],
"theta":[0.36763778794193236,0.24216791563667922,2.2520854345903762,5.535759442804399,7.087739373951743,2.9972862403619374,-0.9138041110985555,-1.5653869258976254,3.1485478393502975,4.2117132848675345,7.812296365137946,1.2730389458852223,-0.8909307291192041,-1.9721982630084989,0.9764229099003393,5.646050806887254,3.459836179912905,3.7005965141176693,-0.02918268520492165,-0.1699492177434879,-3.205087466632684,9.462549627273786,5.029087403069214,-1.434354419867131,0.03507639479558166,-0.49251555325113205,6.648984980838687,23.377426935183124,23.022387423127885,11.012768420772638],
"ID":["01","01","01","01","01","01","02","02","02","02","02","02","03","03","03","03","03","03","04","04","04","04","04","04","05","05","05","05","05","05"]
},
"mapping":{
"x":"Condition",
"y":"theta",
"color":"ROI",
"shape":"ROI"
},
"data_meta":{
},
"facet":{
"name":"grid",
"x":"ID",
"x_order":1,
"y_order":1
},
"ggsize":{
"width":800,
"height":300
},
"kind":"plot",
"scales":[],
"layers":[{
"geom":"hline",
"mapping":{
},
"data_meta":{
},
"y_intercept":0,
"linetype":"dashed",
"size":1,
"data":{
}
},{
"geom":"point",
"mapping":{
},
"data_meta":{
},
"size":5,
"data":{
}
}]
};
       var plotContainer = document.getElementById("QIpxym");
       LetsPlot.buildPlotFromProcessedSpecs(plotSpec, -1, -1, plotContainer);
   </script>
   </body>
</html>
</div>
<br />
<br /></div>
<div class="section" id="compute-group-level-results">
<h2><a class="toc-backref" href="#id4">Compute group level results</a><a class="headerlink" href="#compute-group-level-results" title="Permalink to this headline">¶</a></h2>
<div class="sidebar">
<p class="sidebar-title">Relevant literature</p>
<p>For an introduction to mixed effects analysis see:
Winter, Bodo. “A very basic tutorial for performing linear mixed effects
analyses.” arXiv preprint arXiv:1308.5499 (2013).</p>
<p>For a summary of linear mixed models in python
and the relation to lmer see:
<a class="reference external" href="https://www.statsmodels.org/stable/mixed_linear.html#mixedlmmod" title="(in statsmodels vv0.12.2)"><span class="xref std std-ref">statsmodels docs</span></a></p>
<p>For a summary of these models in the context of fNIRS see section 3.5 of:
Santosa, H., Zhai, X., Fishburn, F., &amp; Huppert, T. (2018).
The NIRS brain AnalyzIR toolbox. Algorithms, 11(5), 73.</p>
</div>
<p>Next we use a linear mixed effects model to examine the
relation between conditions and our response estimate (theta).
Combinations of 3 fixed effects will be evaluated, ROI (left vs right),
condition (control, tapping/left, tapping/right), and chromophore (HbO, HbR).
With a random effect of subject.
Alternatively, you could export the group dataframe (<cite>df_roi.to_csv()</cite>) and
analyse in your favorite stats program.</p>
<p>We do not explore the modeling procedure in depth here as topics
such model selection and examining residuals are beyond the scope of
this example (see relevant literature).
Alternatively, we could use a robust linear
model by using the code
<cite>roi_model = rlm(‘theta ~ -1 + ROI:Condition:Chroma’, grp_results).fit()</cite>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">grp_results</span> <span class="o">=</span> <span class="n">df_roi</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;Condition in [&#39;Control&#39;,&#39;Tapping/Left&#39;, &#39;Tapping/Right&#39;]&quot;</span><span class="p">)</span>

<span class="n">roi_model</span> <span class="o">=</span> <a href="https://www.statsmodels.org/stable/generated/statsmodels.formula.api.mixedlm.html#statsmodels.formula.api.mixedlm" title="statsmodels.formula.api.mixedlm" class="sphx-glr-backref-module-statsmodels-formula-api sphx-glr-backref-type-py-function"><span class="n">smf</span><span class="o">.</span><span class="n">mixedlm</span></a><span class="p">(</span><span class="s2">&quot;theta ~ -1 + ROI:Condition:Chroma&quot;</span><span class="p">,</span>
                        <span class="n">grp_results</span><span class="p">,</span> <span class="n">groups</span><span class="o">=</span><span class="n">grp_results</span><span class="p">[</span><span class="s2">&quot;ID&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;nm&#39;</span><span class="p">)</span>
<span class="n">roi_model</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>/opt/hostedtoolcache/Python/3.8.10/x64/lib/python3.8/site-packages/statsmodels/regression/mixed_linear_model.py:2237: ConvergenceWarning: The MLE may be on the boundary of the parameter space.
  warnings.warn(msg, ConvergenceWarning)
</pre></div>
</div>
<div class="output_subarea output_html rendered_html output_result">
<table class="simpletable">
<tr>
       <td>Model:</td>       <td>MixedLM</td> <td>Dependent Variable:</td>   <td>theta</td>
</tr>
<tr>
  <td>No. Observations:</td>   <td>60</td>          <td>Method:</td>         <td>REML</td>
</tr>
<tr>
     <td>No. Groups:</td>       <td>5</td>          <td>Scale:</td>         <td>16.2279</td>
</tr>
<tr>
  <td>Min. group size:</td>    <td>12</td>      <td>Log-Likelihood:</td>   <td>-144.6473</td>
</tr>
<tr>
  <td>Max. group size:</td>    <td>12</td>        <td>Converged:</td>         <td>Yes</td>
</tr>
<tr>
  <td>Mean group size:</td>   <td>12.0</td>            <td></td>               <td></td>
</tr>
</table>
<table class="simpletable">
<tr>
                               <td></td>                               <th>Coef.</th> <th>Std.Err.</th>    <th>z</th>   <th>P>|z|</th> <th>[0.025</th> <th>0.975]</th>
</tr>
<tr>
  <th>ROI[Left_Hemisphere]:Condition[Control]:Chroma[hbo]</th>        <td>-0.286</td>   <td>1.802</td>  <td>-0.159</td> <td>0.874</td> <td>-3.817</td>  <td>3.245</td>
</tr>
<tr>
  <th>ROI[Right_Hemisphere]:Condition[Control]:Chroma[hbo]</th>       <td>-0.792</td>   <td>1.802</td>  <td>-0.439</td> <td>0.660</td> <td>-4.323</td>  <td>2.739</td>
</tr>
<tr>
  <th>ROI[Left_Hemisphere]:Condition[Tapping/Left]:Chroma[hbo]</th>    <td>1.964</td>   <td>1.802</td>   <td>1.090</td> <td>0.276</td> <td>-1.567</td>  <td>5.495</td>
</tr>
<tr>
  <th>ROI[Right_Hemisphere]:Condition[Tapping/Left]:Chroma[hbo]</th>   <td>9.647</td>   <td>1.802</td>   <td>5.355</td> <td>0.000</td>  <td>6.116</td> <td>13.178</td>
</tr>
<tr>
  <th>ROI[Left_Hemisphere]:Condition[Tapping/Right]:Chroma[hbo]</th>   <td>9.282</td>   <td>1.802</td>   <td>5.152</td> <td>0.000</td>  <td>5.751</td> <td>12.813</td>
</tr>
<tr>
  <th>ROI[Right_Hemisphere]:Condition[Tapping/Right]:Chroma[hbo]</th>  <td>3.510</td>   <td>1.802</td>   <td>1.948</td> <td>0.051</td> <td>-0.021</td>  <td>7.041</td>
</tr>
<tr>
  <th>ROI[Left_Hemisphere]:Condition[Control]:Chroma[hbr]</th>         <td>0.269</td>   <td>1.802</td>   <td>0.149</td> <td>0.881</td> <td>-3.262</td>  <td>3.800</td>
</tr>
<tr>
  <th>ROI[Right_Hemisphere]:Condition[Control]:Chroma[hbr]</th>        <td>0.104</td>   <td>1.802</td>   <td>0.058</td> <td>0.954</td> <td>-3.427</td>  <td>3.635</td>
</tr>
<tr>
  <th>ROI[Left_Hemisphere]:Condition[Tapping/Left]:Chroma[hbr]</th>   <td>-2.004</td>   <td>1.802</td>  <td>-1.112</td> <td>0.266</td> <td>-5.535</td>  <td>1.527</td>
</tr>
<tr>
  <th>ROI[Right_Hemisphere]:Condition[Tapping/Left]:Chroma[hbr]</th>  <td>-4.265</td>   <td>1.802</td>  <td>-2.367</td> <td>0.018</td> <td>-7.795</td> <td>-0.734</td>
</tr>
<tr>
  <th>ROI[Left_Hemisphere]:Condition[Tapping/Right]:Chroma[hbr]</th>  <td>-4.133</td>   <td>1.802</td>  <td>-2.294</td> <td>0.022</td> <td>-7.664</td> <td>-0.602</td>
</tr>
<tr>
  <th>ROI[Right_Hemisphere]:Condition[Tapping/Right]:Chroma[hbr]</th> <td>-1.770</td>   <td>1.802</td>  <td>-0.983</td> <td>0.326</td> <td>-5.301</td>  <td>1.761</td>
</tr>
<tr>
  <th>Group Var</th>                                                   <td>0.000</td>   <td>0.272</td>     <td></td>      <td></td>       <td></td>       <td></td>
</tr>
</table>
</div>
<br />
<br /></div>
<div class="section" id="visualise-group-results">
<h2><a class="toc-backref" href="#id5">Visualise group results</a><a class="headerlink" href="#visualise-group-results" title="Permalink to this headline">¶</a></h2>
<p>Now we can summarise the output of the second level model.
This figure shows that the control condition has small responses that
are not significantly different to zero for both HbO
and HbR in both hemispheres.
Whereas clear significant responses are show for the two tapping conditions.
We also observe the the tapping response is
larger in the contralateral hemisphere.
Filled symbols represent HbO, unfilled symbols represent HbR.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <a href="../../generated/mne_nirs.statistics.statsmodels_to_results.html#mne_nirs.statistics.statsmodels_to_results" title="mne_nirs.statistics.statsmodels_to_results" class="sphx-glr-backref-module-mne_nirs-statistics sphx-glr-backref-type-py-function"><span class="n">statsmodels_to_results</span></a><span class="p">(</span><span class="n">roi_model</span><span class="p">)</span>

<span class="n">ggplot</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;Chroma == &#39;hbo&#39;&quot;</span><span class="p">),</span>
       <span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;Condition&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;Coef.&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;Significant&#39;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="s1">&#39;ROI&#39;</span><span class="p">))</span> \
    <span class="o">+</span> <span class="n">geom_hline</span><span class="p">(</span><span class="n">y_intercept</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">linetype</span><span class="o">=</span><span class="s2">&quot;dashed&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> \
    <span class="o">+</span> <span class="n">geom_point</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span> \
    <span class="o">+</span> <span class="n">scale_shape_manual</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="p">[</span><span class="mi">16</span><span class="p">,</span> <span class="mi">17</span><span class="p">])</span> \
    <span class="o">+</span> <span class="n">ggsize</span><span class="p">(</span><span class="mi">800</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span> \
    <span class="o">+</span> <span class="n">geom_point</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;Chroma == &#39;hbr&#39;&quot;</span><span class="p">)</span>
                 <span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;ROI == &#39;Left_Hemisphere&#39;&quot;</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> \
    <span class="o">+</span> <span class="n">geom_point</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;Chroma == &#39;hbr&#39;&quot;</span><span class="p">)</span>
                 <span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;ROI == &#39;Right_Hemisphere&#39;&quot;</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<div class="output_subarea output_html rendered_html output_result">
<html lang="en">
   <head>
       <script type="text/javascript" data-lets-plot-script="library" src="https://cdn.jsdelivr.net/gh/JetBrains/lets-plot@v2.0.4/js-package/distr/lets-plot.min.js"></script>
   </head>
   <body>
          <div id="cCArle"></div>
   <script type="text/javascript" data-lets-plot-script="plot">
       var plotSpec={
"data":{
"Coef.":[-0.28624066853703345,-0.7915764088528128,1.9641907396094027,9.64670001940322,9.282269349039941,3.5098671402540655],
"ROI":["Left_Hemisphere","Right_Hemisphere","Left_Hemisphere","Right_Hemisphere","Left_Hemisphere","Right_Hemisphere"],
"Condition":["Control","Control","Tapping/Left","Tapping/Left","Tapping/Right","Tapping/Right"],
"Significant":[false,false,false,true,true,false]
},
"mapping":{
"x":"Condition",
"y":"Coef.",
"color":"Significant",
"shape":"ROI"
},
"data_meta":{
},
"ggsize":{
"width":800,
"height":300
},
"kind":"plot",
"scales":[{
"aesthetic":"shape",
"values":[16,17]
}],
"layers":[{
"geom":"hline",
"mapping":{
},
"data_meta":{
},
"y_intercept":0,
"linetype":"dashed",
"size":1,
"data":{
}
},{
"geom":"point",
"mapping":{
},
"data_meta":{
},
"size":5,
"data":{
}
},{
"geom":"point",
"data":{
"Coef.":[0.2685613046756379,-2.0041359222210744,-4.133400318183256],
"Condition":["Control","Tapping/Left","Tapping/Right"],
"Significant":[false,false,true]
},
"mapping":{
},
"data_meta":{
},
"size":5,
"shape":1
},{
"geom":"point",
"data":{
"Coef.":[0.10387550370193072,-4.264512597644622,-1.770381914939157],
"Condition":["Control","Tapping/Left","Tapping/Right"],
"Significant":[false,true,false]
},
"mapping":{
},
"data_meta":{
},
"size":5,
"shape":2
}]
};
       var plotContainer = document.getElementById("cCArle");
       LetsPlot.buildPlotFromProcessedSpecs(plotSpec, -1, -1, plotContainer);
   </script>
   </body>
</html>
</div>
<br />
<br /></div>
<div class="section" id="group-topographic-visualisation">
<h2><a class="toc-backref" href="#id6">Group topographic visualisation</a><a class="headerlink" href="#group-topographic-visualisation" title="Permalink to this headline">¶</a></h2>
<p>We can also view the topographic representation of the data
(rather than the ROI summary above).
Here we just plot the oxyhaemoglobin for the two tapping conditions.
First we compute the mixed effects model for each channel (rather
than region of interest as above).
Then we pass these results to the topomap function.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><a href="https://matplotlib.org/api/figure_api.html#matplotlib.figure.Figure" title="matplotlib.figure.Figure" class="sphx-glr-backref-module-matplotlib-figure sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">fig</span></a><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <a href="https://matplotlib.org/api/_as_gen/matplotlib.pyplot.subplots.html#matplotlib.pyplot.subplots" title="matplotlib.pyplot.subplots" class="sphx-glr-backref-module-matplotlib-pyplot sphx-glr-backref-type-py-function"><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span></a><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
                         <span class="n">gridspec_kw</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">width_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]))</span>

<span class="c1"># Cut down the dataframe just to the conditions we are interested in</span>
<span class="n">ch_summary</span> <span class="o">=</span> <span class="n">df_cha</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;Condition in [&#39;Tapping/Left&#39;, &#39;Tapping/Right&#39;]&quot;</span><span class="p">)</span>
<span class="n">ch_summary</span> <span class="o">=</span> <span class="n">ch_summary</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;Chroma in [&#39;hbo&#39;]&quot;</span><span class="p">)</span>

<span class="c1"># Run group level model and convert to dataframe</span>
<span class="n">ch_model</span> <span class="o">=</span> <a href="https://www.statsmodels.org/stable/generated/statsmodels.formula.api.mixedlm.html#statsmodels.formula.api.mixedlm" title="statsmodels.formula.api.mixedlm" class="sphx-glr-backref-module-statsmodels-formula-api sphx-glr-backref-type-py-function"><span class="n">smf</span><span class="o">.</span><span class="n">mixedlm</span></a><span class="p">(</span><span class="s2">&quot;theta ~ -1 + ch_name:Chroma:Condition&quot;</span><span class="p">,</span>
                       <span class="n">ch_summary</span><span class="p">,</span> <span class="n">groups</span><span class="o">=</span><span class="n">ch_summary</span><span class="p">[</span><span class="s2">&quot;ID&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;nm&#39;</span><span class="p">)</span>
<span class="n">ch_model_df</span> <span class="o">=</span> <a href="../../generated/mne_nirs.statistics.statsmodels_to_results.html#mne_nirs.statistics.statsmodels_to_results" title="mne_nirs.statistics.statsmodels_to_results" class="sphx-glr-backref-module-mne_nirs-statistics sphx-glr-backref-type-py-function"><span class="n">statsmodels_to_results</span></a><span class="p">(</span><span class="n">ch_model</span><span class="p">)</span>

<span class="c1"># Plot the two conditions</span>
<a href="../../generated/mne_nirs.visualisation.plot_glm_group_topo.html#mne_nirs.visualisation.plot_glm_group_topo" title="mne_nirs.visualisation.plot_glm_group_topo" class="sphx-glr-backref-module-mne_nirs-visualisation sphx-glr-backref-type-py-function"><span class="n">plot_glm_group_topo</span></a><span class="p">(</span><a href="https://mne.tools/stable/generated/mne.io.BaseRaw.html#mne.io.BaseRaw.copy" title="mne.io.BaseRaw.copy" class="sphx-glr-backref-module-mne-io sphx-glr-backref-type-py-method"><span class="n">raw_haemo</span><span class="o">.</span><span class="n">copy</span></a><span class="p">()</span><span class="o">.</span><span class="n">pick</span><span class="p">(</span><span class="n">picks</span><span class="o">=</span><span class="s2">&quot;hbo&quot;</span><span class="p">),</span>
                    <span class="n">ch_model_df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;Condition in [&#39;Tapping/Left&#39;]&quot;</span><span class="p">),</span>
                    <span class="n">colorbar</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                    <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><a href="https://matplotlib.org/api/_as_gen/matplotlib.colors.LinearSegmentedColormap.html#matplotlib.colors.LinearSegmentedColormap" title="matplotlib.colors.LinearSegmentedColormap" class="sphx-glr-backref-module-matplotlib-colors sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">mpl</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Oranges</span></a><span class="p">)</span>

<a href="../../generated/mne_nirs.visualisation.plot_glm_group_topo.html#mne_nirs.visualisation.plot_glm_group_topo" title="mne_nirs.visualisation.plot_glm_group_topo" class="sphx-glr-backref-module-mne_nirs-visualisation sphx-glr-backref-type-py-function"><span class="n">plot_glm_group_topo</span></a><span class="p">(</span><a href="https://mne.tools/stable/generated/mne.io.BaseRaw.html#mne.io.BaseRaw.copy" title="mne.io.BaseRaw.copy" class="sphx-glr-backref-module-mne-io sphx-glr-backref-type-py-method"><span class="n">raw_haemo</span><span class="o">.</span><span class="n">copy</span></a><span class="p">()</span><span class="o">.</span><span class="n">pick</span><span class="p">(</span><span class="n">picks</span><span class="o">=</span><span class="s2">&quot;hbo&quot;</span><span class="p">),</span>
                    <span class="n">ch_model_df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;Condition in [&#39;Tapping/Right&#39;]&quot;</span><span class="p">),</span>
                    <span class="n">colorbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                    <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><a href="https://matplotlib.org/api/_as_gen/matplotlib.colors.LinearSegmentedColormap.html#matplotlib.colors.LinearSegmentedColormap" title="matplotlib.colors.LinearSegmentedColormap" class="sphx-glr-backref-module-matplotlib-colors sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">mpl</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Oranges</span></a><span class="p">)</span>

<span class="c1"># Cut down the dataframe just to the conditions we are interested in</span>
<span class="n">ch_summary</span> <span class="o">=</span> <span class="n">df_cha</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;Condition in [&#39;Tapping/Left&#39;, &#39;Tapping/Right&#39;]&quot;</span><span class="p">)</span>
<span class="n">ch_summary</span> <span class="o">=</span> <span class="n">ch_summary</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;Chroma in [&#39;hbr&#39;]&quot;</span><span class="p">)</span>

<span class="c1"># Run group level model and convert to dataframe</span>
<span class="n">ch_model</span> <span class="o">=</span> <a href="https://www.statsmodels.org/stable/generated/statsmodels.formula.api.mixedlm.html#statsmodels.formula.api.mixedlm" title="statsmodels.formula.api.mixedlm" class="sphx-glr-backref-module-statsmodels-formula-api sphx-glr-backref-type-py-function"><span class="n">smf</span><span class="o">.</span><span class="n">mixedlm</span></a><span class="p">(</span><span class="s2">&quot;theta ~ -1 + ch_name:Chroma:Condition&quot;</span><span class="p">,</span>
                       <span class="n">ch_summary</span><span class="p">,</span> <span class="n">groups</span><span class="o">=</span><span class="n">ch_summary</span><span class="p">[</span><span class="s2">&quot;ID&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;nm&#39;</span><span class="p">)</span>
<span class="n">ch_model_df</span> <span class="o">=</span> <a href="../../generated/mne_nirs.statistics.statsmodels_to_results.html#mne_nirs.statistics.statsmodels_to_results" title="mne_nirs.statistics.statsmodels_to_results" class="sphx-glr-backref-module-mne_nirs-statistics sphx-glr-backref-type-py-function"><span class="n">statsmodels_to_results</span></a><span class="p">(</span><span class="n">ch_model</span><span class="p">)</span>

<span class="c1"># Plot the two conditions</span>
<a href="../../generated/mne_nirs.visualisation.plot_glm_group_topo.html#mne_nirs.visualisation.plot_glm_group_topo" title="mne_nirs.visualisation.plot_glm_group_topo" class="sphx-glr-backref-module-mne_nirs-visualisation sphx-glr-backref-type-py-function"><span class="n">plot_glm_group_topo</span></a><span class="p">(</span><a href="https://mne.tools/stable/generated/mne.io.BaseRaw.html#mne.io.BaseRaw.copy" title="mne.io.BaseRaw.copy" class="sphx-glr-backref-module-mne-io sphx-glr-backref-type-py-method"><span class="n">raw_haemo</span><span class="o">.</span><span class="n">copy</span></a><span class="p">()</span><span class="o">.</span><span class="n">pick</span><span class="p">(</span><span class="n">picks</span><span class="o">=</span><span class="s2">&quot;hbr&quot;</span><span class="p">),</span>
                    <span class="n">ch_model_df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;Condition in [&#39;Tapping/Left&#39;]&quot;</span><span class="p">),</span>
                    <span class="n">colorbar</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                    <span class="n">vmin</span><span class="o">=-</span><span class="mi">10</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><a href="https://matplotlib.org/api/_as_gen/matplotlib.colors.LinearSegmentedColormap.html#matplotlib.colors.LinearSegmentedColormap" title="matplotlib.colors.LinearSegmentedColormap" class="sphx-glr-backref-module-matplotlib-colors sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">mpl</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Blues_r</span></a><span class="p">)</span>
<a href="../../generated/mne_nirs.visualisation.plot_glm_group_topo.html#mne_nirs.visualisation.plot_glm_group_topo" title="mne_nirs.visualisation.plot_glm_group_topo" class="sphx-glr-backref-module-mne_nirs-visualisation sphx-glr-backref-type-py-function"><span class="n">plot_glm_group_topo</span></a><span class="p">(</span><a href="https://mne.tools/stable/generated/mne.io.BaseRaw.html#mne.io.BaseRaw.copy" title="mne.io.BaseRaw.copy" class="sphx-glr-backref-module-mne-io sphx-glr-backref-type-py-method"><span class="n">raw_haemo</span><span class="o">.</span><span class="n">copy</span></a><span class="p">()</span><span class="o">.</span><span class="n">pick</span><span class="p">(</span><span class="n">picks</span><span class="o">=</span><span class="s2">&quot;hbr&quot;</span><span class="p">),</span>
                    <span class="n">ch_model_df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;Condition in [&#39;Tapping/Right&#39;]&quot;</span><span class="p">),</span>
                    <span class="n">colorbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                    <span class="n">vmin</span><span class="o">=-</span><span class="mi">10</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><a href="https://matplotlib.org/api/_as_gen/matplotlib.colors.LinearSegmentedColormap.html#matplotlib.colors.LinearSegmentedColormap" title="matplotlib.colors.LinearSegmentedColormap" class="sphx-glr-backref-module-matplotlib-colors sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">mpl</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Blues_r</span></a><span class="p">)</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_plot_12_group_glm_001.png" srcset="../../_images/sphx_glr_plot_12_group_glm_001.png" alt="Tapping/Left, Tapping/Right, Tapping/Left, Tapping/Right" class = "sphx-glr-single-img"/><p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:title={&#39;center&#39;:&#39;Tapping/Right&#39;}&gt;
</pre></div>
</div>
</div>
<div class="section" id="contrasts">
<h2><a class="toc-backref" href="#id7">Contrasts</a><a class="headerlink" href="#contrasts" title="Permalink to this headline">¶</a></h2>
<p>Finally we can examine the difference between the left and right hand
tapping conditions by viewing the contrast results
in a topographic representation.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><a href="https://matplotlib.org/api/figure_api.html#matplotlib.figure.Figure" title="matplotlib.figure.Figure" class="sphx-glr-backref-module-matplotlib-figure sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">fig</span></a><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <a href="https://matplotlib.org/api/_as_gen/matplotlib.pyplot.subplots.html#matplotlib.pyplot.subplots" title="matplotlib.pyplot.subplots" class="sphx-glr-backref-module-matplotlib-pyplot sphx-glr-backref-type-py-function"><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span></a><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">con_summary</span> <span class="o">=</span> <span class="n">df_con</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;Chroma in [&#39;hbo&#39;]&quot;</span><span class="p">)</span>

<span class="c1"># Run group level model and convert to dataframe</span>
<span class="n">con_model</span> <span class="o">=</span> <a href="https://www.statsmodels.org/stable/generated/statsmodels.formula.api.mixedlm.html#statsmodels.formula.api.mixedlm" title="statsmodels.formula.api.mixedlm" class="sphx-glr-backref-module-statsmodels-formula-api sphx-glr-backref-type-py-function"><span class="n">smf</span><span class="o">.</span><span class="n">mixedlm</span></a><span class="p">(</span><span class="s2">&quot;effect ~ -1 + ch_name:Chroma&quot;</span><span class="p">,</span>
                        <span class="n">con_summary</span><span class="p">,</span> <span class="n">groups</span><span class="o">=</span><span class="n">con_summary</span><span class="p">[</span><span class="s2">&quot;ID&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;nm&#39;</span><span class="p">)</span>
<span class="n">con_model_df</span> <span class="o">=</span> <a href="../../generated/mne_nirs.statistics.statsmodels_to_results.html#mne_nirs.statistics.statsmodels_to_results" title="mne_nirs.statistics.statsmodels_to_results" class="sphx-glr-backref-module-mne_nirs-statistics sphx-glr-backref-type-py-function"><span class="n">statsmodels_to_results</span></a><span class="p">(</span><span class="n">con_model</span><span class="p">,</span>
                                      <span class="n">order</span><span class="o">=</span><a href="https://mne.tools/stable/generated/mne.io.BaseRaw.html#mne.io.BaseRaw.copy" title="mne.io.BaseRaw.copy" class="sphx-glr-backref-module-mne-io sphx-glr-backref-type-py-method"><span class="n">raw_haemo</span><span class="o">.</span><span class="n">copy</span></a><span class="p">()</span><span class="o">.</span><span class="n">pick</span><span class="p">(</span>
                                          <span class="n">picks</span><span class="o">=</span><span class="s2">&quot;hbo&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">ch_names</span><span class="p">)</span>

<a href="../../generated/mne_nirs.visualisation.plot_glm_group_topo.html#mne_nirs.visualisation.plot_glm_group_topo" title="mne_nirs.visualisation.plot_glm_group_topo" class="sphx-glr-backref-module-mne_nirs-visualisation sphx-glr-backref-type-py-function"><span class="n">plot_glm_group_topo</span></a><span class="p">(</span><a href="https://mne.tools/stable/generated/mne.io.BaseRaw.html#mne.io.BaseRaw.copy" title="mne.io.BaseRaw.copy" class="sphx-glr-backref-module-mne-io sphx-glr-backref-type-py-method"><span class="n">raw_haemo</span><span class="o">.</span><span class="n">copy</span></a><span class="p">()</span><span class="o">.</span><span class="n">pick</span><span class="p">(</span><span class="n">picks</span><span class="o">=</span><span class="s2">&quot;hbo&quot;</span><span class="p">),</span>
                    <span class="n">con_model_df</span><span class="p">,</span> <span class="n">colorbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="n">axes</span><span class="p">)</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_plot_12_group_glm_002.png" srcset="../../_images/sphx_glr_plot_12_group_glm_002.png" alt="Contrast" class = "sphx-glr-single-img"/><p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>/opt/hostedtoolcache/Python/3.8.10/x64/lib/python3.8/site-packages/statsmodels/regression/mixed_linear_model.py:2237: ConvergenceWarning: The MLE may be on the boundary of the parameter space.
  warnings.warn(msg, ConvergenceWarning)
/opt/hostedtoolcache/Python/3.8.10/x64/lib/python3.8/site-packages/statsmodels/regression/mixed_linear_model.py:2261: ConvergenceWarning: The Hessian matrix at the estimated parameter values is not positive definite.
  warnings.warn(msg, ConvergenceWarning)

&lt;AxesSubplot:title={&#39;center&#39;:&#39;Contrast&#39;}&gt;
</pre></div>
</div>
<p>Or we can view only the left hemisphere for the contrast.
And set all channels that dont have a significant response to zero.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><a href="../../generated/mne_nirs.visualisation.plot_glm_group_topo.html#mne_nirs.visualisation.plot_glm_group_topo" title="mne_nirs.visualisation.plot_glm_group_topo" class="sphx-glr-backref-module-mne_nirs-visualisation sphx-glr-backref-type-py-function"><span class="n">plot_glm_group_topo</span></a><span class="p">(</span><a href="https://mne.tools/stable/generated/mne.io.BaseRaw.html#mne.io.BaseRaw.copy" title="mne.io.BaseRaw.copy" class="sphx-glr-backref-module-mne-io sphx-glr-backref-type-py-method"><span class="n">raw_haemo</span><span class="o">.</span><span class="n">copy</span></a><span class="p">()</span><span class="o">.</span><span class="n">pick</span><span class="p">(</span><span class="n">picks</span><span class="o">=</span><span class="s2">&quot;hbo&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">pick</span><span class="p">(</span><span class="n">picks</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)),</span>
                    <span class="n">con_model_df</span><span class="p">,</span> <span class="n">colorbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_plot_12_group_glm_003.png" srcset="../../_images/sphx_glr_plot_12_group_glm_003.png" alt="Contrast" class = "sphx-glr-single-img"/><p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Reducing GLM results to match MNE data

&lt;AxesSubplot:title={&#39;center&#39;:&#39;Contrast&#39;}&gt;
</pre></div>
</div>
</div>
<div class="section" id="table-of-channel-level-results">
<h2><a class="toc-backref" href="#id8">Table of channel level results</a><a class="headerlink" href="#table-of-channel-level-results" title="Permalink to this headline">¶</a></h2>
<p>Sometimes a reviewer wants a long table of results per channel.
This can be generated from the statistics dataframe.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ch_summary</span> <span class="o">=</span> <span class="n">df_cha</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;Condition in [&#39;Tapping/Left&#39;, &#39;Tapping/Right&#39;]&quot;</span><span class="p">)</span>
<span class="n">ch_summary</span> <span class="o">=</span> <span class="n">ch_summary</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;Chroma in [&#39;hbo&#39;]&quot;</span><span class="p">)</span>

<span class="c1"># Run group level model and convert to dataframe</span>
<span class="n">ch_model</span> <span class="o">=</span> <a href="https://www.statsmodels.org/stable/generated/statsmodels.formula.api.mixedlm.html#statsmodels.formula.api.mixedlm" title="statsmodels.formula.api.mixedlm" class="sphx-glr-backref-module-statsmodels-formula-api sphx-glr-backref-type-py-function"><span class="n">smf</span><span class="o">.</span><span class="n">mixedlm</span></a><span class="p">(</span><span class="s2">&quot;theta ~ -1 + ch_name:Chroma:Condition&quot;</span><span class="p">,</span>
                       <span class="n">ch_summary</span><span class="p">,</span> <span class="n">groups</span><span class="o">=</span><span class="n">ch_summary</span><span class="p">[</span><span class="s2">&quot;ID&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;nm&#39;</span><span class="p">)</span>

<span class="c1"># Here we can use the order argument to ensure the channel name order</span>
<span class="n">ch_model_df</span> <span class="o">=</span> <a href="../../generated/mne_nirs.statistics.statsmodels_to_results.html#mne_nirs.statistics.statsmodels_to_results" title="mne_nirs.statistics.statsmodels_to_results" class="sphx-glr-backref-module-mne_nirs-statistics sphx-glr-backref-type-py-function"><span class="n">statsmodels_to_results</span></a><span class="p">(</span><span class="n">ch_model</span><span class="p">,</span>
                                     <span class="n">order</span><span class="o">=</span><a href="https://mne.tools/stable/generated/mne.io.BaseRaw.html#mne.io.BaseRaw.copy" title="mne.io.BaseRaw.copy" class="sphx-glr-backref-module-mne-io sphx-glr-backref-type-py-method"><span class="n">raw_haemo</span><span class="o">.</span><span class="n">copy</span></a><span class="p">()</span><span class="o">.</span><span class="n">pick</span><span class="p">(</span>
                                         <span class="n">picks</span><span class="o">=</span><span class="s2">&quot;hbo&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">ch_names</span><span class="p">)</span>
<span class="c1"># And make the table prettier</span>
<span class="n">ch_model_df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ch_model_df</span> <span class="o">=</span> <span class="n">ch_model_df</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;ch_name&#39;</span><span class="p">,</span> <span class="s1">&#39;Condition&#39;</span><span class="p">])</span>
<span class="n">ch_model_df</span>
</pre></div>
</div>
<div class="output_subarea output_html rendered_html output_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>Coef.</th>
      <th>Std.Err.</th>
      <th>z</th>
      <th>P&gt;|z|</th>
      <th>[0.025</th>
      <th>0.975]</th>
      <th>Chroma</th>
      <th>Significant</th>
    </tr>
    <tr>
      <th>ch_name</th>
      <th>Condition</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="2" valign="top">S1_D1 hbo</th>
      <th>Tapping/Left</th>
      <td>2.737095</td>
      <td>4.195591</td>
      <td>0.652374</td>
      <td>0.514160</td>
      <td>-5.486112</td>
      <td>10.960301</td>
      <td>hbo</td>
      <td>False</td>
    </tr>
    <tr>
      <th>Tapping/Right</th>
      <td>6.594783</td>
      <td>4.195591</td>
      <td>1.571837</td>
      <td>0.115988</td>
      <td>-1.628423</td>
      <td>14.81799</td>
      <td>hbo</td>
      <td>False</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">S1_D2 hbo</th>
      <th>Tapping/Left</th>
      <td>0.743025</td>
      <td>4.195591</td>
      <td>0.177097</td>
      <td>0.859432</td>
      <td>-7.480181</td>
      <td>8.966232</td>
      <td>hbo</td>
      <td>False</td>
    </tr>
    <tr>
      <th>Tapping/Right</th>
      <td>7.159065</td>
      <td>4.195591</td>
      <td>1.706331</td>
      <td>0.087947</td>
      <td>-1.064142</td>
      <td>15.382271</td>
      <td>hbo</td>
      <td>False</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">S1_D3 hbo</th>
      <th>Tapping/Left</th>
      <td>1.979368</td>
      <td>4.195591</td>
      <td>0.471773</td>
      <td>0.637088</td>
      <td>-6.243838</td>
      <td>10.202575</td>
      <td>hbo</td>
      <td>False</td>
    </tr>
    <tr>
      <th>Tapping/Right</th>
      <td>17.050793</td>
      <td>4.195591</td>
      <td>4.063979</td>
      <td>0.000048</td>
      <td>8.827587</td>
      <td>25.274</td>
      <td>hbo</td>
      <td>True</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">S2_D1 hbo</th>
      <th>Tapping/Left</th>
      <td>-0.032397</td>
      <td>4.195591</td>
      <td>-0.007722</td>
      <td>0.993839</td>
      <td>-8.255603</td>
      <td>8.19081</td>
      <td>hbo</td>
      <td>False</td>
    </tr>
    <tr>
      <th>Tapping/Right</th>
      <td>1.183063</td>
      <td>4.195591</td>
      <td>0.281978</td>
      <td>0.777961</td>
      <td>-7.040143</td>
      <td>9.40627</td>
      <td>hbo</td>
      <td>False</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">S2_D3 hbo</th>
      <th>Tapping/Left</th>
      <td>1.003134</td>
      <td>4.195591</td>
      <td>0.239092</td>
      <td>0.811034</td>
      <td>-7.220073</td>
      <td>9.22634</td>
      <td>hbo</td>
      <td>False</td>
    </tr>
    <tr>
      <th>Tapping/Right</th>
      <td>6.892621</td>
      <td>4.195591</td>
      <td>1.642825</td>
      <td>0.100419</td>
      <td>-1.330585</td>
      <td>15.115828</td>
      <td>hbo</td>
      <td>False</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">S2_D4 hbo</th>
      <th>Tapping/Left</th>
      <td>-1.273985</td>
      <td>4.195591</td>
      <td>-0.303649</td>
      <td>0.761396</td>
      <td>-9.497192</td>
      <td>6.949221</td>
      <td>hbo</td>
      <td>False</td>
    </tr>
    <tr>
      <th>Tapping/Right</th>
      <td>0.169087</td>
      <td>4.195591</td>
      <td>0.040301</td>
      <td>0.967853</td>
      <td>-8.054119</td>
      <td>8.392294</td>
      <td>hbo</td>
      <td>False</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">S3_D2 hbo</th>
      <th>Tapping/Left</th>
      <td>3.602213</td>
      <td>4.195591</td>
      <td>0.858571</td>
      <td>0.390577</td>
      <td>-4.620994</td>
      <td>11.825419</td>
      <td>hbo</td>
      <td>False</td>
    </tr>
    <tr>
      <th>Tapping/Right</th>
      <td>9.643033</td>
      <td>4.195591</td>
      <td>2.298373</td>
      <td>0.021541</td>
      <td>1.419827</td>
      <td>17.86624</td>
      <td>hbo</td>
      <td>True</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">S3_D3 hbo</th>
      <th>Tapping/Left</th>
      <td>3.040734</td>
      <td>4.195591</td>
      <td>0.724745</td>
      <td>0.468608</td>
      <td>-5.182472</td>
      <td>11.263941</td>
      <td>hbo</td>
      <td>False</td>
    </tr>
    <tr>
      <th>Tapping/Right</th>
      <td>13.394102</td>
      <td>4.195591</td>
      <td>3.192424</td>
      <td>0.001411</td>
      <td>5.170896</td>
      <td>21.617309</td>
      <td>hbo</td>
      <td>True</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">S4_D3 hbo</th>
      <th>Tapping/Left</th>
      <td>2.818356</td>
      <td>4.195591</td>
      <td>0.671742</td>
      <td>0.501748</td>
      <td>-5.40485</td>
      <td>11.041562</td>
      <td>hbo</td>
      <td>False</td>
    </tr>
    <tr>
      <th>Tapping/Right</th>
      <td>9.806812</td>
      <td>4.195591</td>
      <td>2.337409</td>
      <td>0.019418</td>
      <td>1.583606</td>
      <td>18.030019</td>
      <td>hbo</td>
      <td>True</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">S4_D4 hbo</th>
      <th>Tapping/Left</th>
      <td>5.153202</td>
      <td>4.195591</td>
      <td>1.228242</td>
      <td>0.219356</td>
      <td>-3.070005</td>
      <td>13.376408</td>
      <td>hbo</td>
      <td>False</td>
    </tr>
    <tr>
      <th>Tapping/Right</th>
      <td>7.295477</td>
      <td>4.195591</td>
      <td>1.738844</td>
      <td>0.082062</td>
      <td>-0.927729</td>
      <td>15.518684</td>
      <td>hbo</td>
      <td>False</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">S5_D5 hbo</th>
      <th>Tapping/Left</th>
      <td>5.682073</td>
      <td>4.195591</td>
      <td>1.354296</td>
      <td>0.175642</td>
      <td>-2.541133</td>
      <td>13.90528</td>
      <td>hbo</td>
      <td>False</td>
    </tr>
    <tr>
      <th>Tapping/Right</th>
      <td>3.154426</td>
      <td>4.195591</td>
      <td>0.751843</td>
      <td>0.452145</td>
      <td>-5.068781</td>
      <td>11.377632</td>
      <td>hbo</td>
      <td>False</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">S5_D6 hbo</th>
      <th>Tapping/Left</th>
      <td>2.677485</td>
      <td>4.195591</td>
      <td>0.638166</td>
      <td>0.523365</td>
      <td>-5.545721</td>
      <td>10.900692</td>
      <td>hbo</td>
      <td>False</td>
    </tr>
    <tr>
      <th>Tapping/Right</th>
      <td>1.514392</td>
      <td>4.195591</td>
      <td>0.360948</td>
      <td>0.718138</td>
      <td>-6.708815</td>
      <td>9.737598</td>
      <td>hbo</td>
      <td>False</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">S5_D7 hbo</th>
      <th>Tapping/Left</th>
      <td>19.372161</td>
      <td>4.195591</td>
      <td>4.617267</td>
      <td>0.000004</td>
      <td>11.148954</td>
      <td>27.595367</td>
      <td>hbo</td>
      <td>True</td>
    </tr>
    <tr>
      <th>Tapping/Right</th>
      <td>4.470708</td>
      <td>4.195591</td>
      <td>1.065573</td>
      <td>0.286617</td>
      <td>-3.752498</td>
      <td>12.693915</td>
      <td>hbo</td>
      <td>False</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">S6_D5 hbo</th>
      <th>Tapping/Left</th>
      <td>2.999096</td>
      <td>4.195591</td>
      <td>0.714821</td>
      <td>0.474720</td>
      <td>-5.22411</td>
      <td>11.222303</td>
      <td>hbo</td>
      <td>False</td>
    </tr>
    <tr>
      <th>Tapping/Right</th>
      <td>2.581611</td>
      <td>4.195591</td>
      <td>0.615315</td>
      <td>0.538347</td>
      <td>-5.641595</td>
      <td>10.804817</td>
      <td>hbo</td>
      <td>False</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">S6_D7 hbo</th>
      <th>Tapping/Left</th>
      <td>12.629307</td>
      <td>4.195591</td>
      <td>3.010138</td>
      <td>0.002611</td>
      <td>4.406101</td>
      <td>20.852513</td>
      <td>hbo</td>
      <td>True</td>
    </tr>
    <tr>
      <th>Tapping/Right</th>
      <td>4.685671</td>
      <td>4.195591</td>
      <td>1.116808</td>
      <td>0.264076</td>
      <td>-3.537536</td>
      <td>12.908877</td>
      <td>hbo</td>
      <td>False</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">S6_D8 hbo</th>
      <th>Tapping/Left</th>
      <td>10.583127</td>
      <td>4.195591</td>
      <td>2.522440</td>
      <td>0.011654</td>
      <td>2.359921</td>
      <td>18.806334</td>
      <td>hbo</td>
      <td>True</td>
    </tr>
    <tr>
      <th>Tapping/Right</th>
      <td>6.113560</td>
      <td>4.195591</td>
      <td>1.457139</td>
      <td>0.145078</td>
      <td>-2.109647</td>
      <td>14.336766</td>
      <td>hbo</td>
      <td>False</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">S7_D6 hbo</th>
      <th>Tapping/Left</th>
      <td>8.633135</td>
      <td>4.195591</td>
      <td>2.057669</td>
      <td>0.039622</td>
      <td>0.409928</td>
      <td>16.856341</td>
      <td>hbo</td>
      <td>True</td>
    </tr>
    <tr>
      <th>Tapping/Right</th>
      <td>3.938374</td>
      <td>4.195591</td>
      <td>0.938694</td>
      <td>0.347888</td>
      <td>-4.284833</td>
      <td>12.16158</td>
      <td>hbo</td>
      <td>False</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">S7_D7 hbo</th>
      <th>Tapping/Left</th>
      <td>10.973454</td>
      <td>4.195591</td>
      <td>2.615473</td>
      <td>0.008910</td>
      <td>2.750248</td>
      <td>19.196661</td>
      <td>hbo</td>
      <td>True</td>
    </tr>
    <tr>
      <th>Tapping/Right</th>
      <td>3.905806</td>
      <td>4.195591</td>
      <td>0.930931</td>
      <td>0.351889</td>
      <td>-4.3174</td>
      <td>12.129013</td>
      <td>hbo</td>
      <td>False</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">S8_D7 hbo</th>
      <th>Tapping/Left</th>
      <td>16.468741</td>
      <td>4.195591</td>
      <td>3.925250</td>
      <td>0.000087</td>
      <td>8.245535</td>
      <td>24.691947</td>
      <td>hbo</td>
      <td>True</td>
    </tr>
    <tr>
      <th>Tapping/Right</th>
      <td>6.932071</td>
      <td>4.195591</td>
      <td>1.652228</td>
      <td>0.098488</td>
      <td>-1.291136</td>
      <td>15.155277</td>
      <td>hbo</td>
      <td>False</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">S8_D8 hbo</th>
      <th>Tapping/Left</th>
      <td>11.668169</td>
      <td>4.195591</td>
      <td>2.781055</td>
      <td>0.005418</td>
      <td>3.444963</td>
      <td>19.891376</td>
      <td>hbo</td>
      <td>True</td>
    </tr>
    <tr>
      <th>Tapping/Right</th>
      <td>8.762187</td>
      <td>4.195591</td>
      <td>2.088428</td>
      <td>0.036759</td>
      <td>0.538981</td>
      <td>16.985394</td>
      <td>hbo</td>
      <td>True</td>
    </tr>
  </tbody>
</table>
</div>
</div>
<br />
<br /><p class="sphx-glr-timing"><strong>Total running time of the script:</strong> ( 0 minutes  12.596 seconds)</p>
<p><strong>Estimated memory usage:</strong>  47 MB</p>
<div class="sphx-glr-footer class sphx-glr-footer-example docutils container" id="sphx-glr-download-auto-examples-general-plot-12-group-glm-py">
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/ad7b38cd82f9127b80c918454c0397d1/plot_12_group_glm.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">plot_12_group_glm.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/87c293567d3aba156304ddcfdfd80005/plot_12_group_glm.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">plot_12_group_glm.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</div>
</div>



              </div>
              
              
              <div class='prev-next-bottom'>
                
    <a class='left-prev' id="prev-link" href="plot_11_hrf_measured.html" title="previous page">GLM Analysis (Measured)</a>
    <a class='right-next' id="next-link" href="plot_15_waveform.html" title="next page">Waveform averaging analysis</a>

              </div>
              
          </main>
          

      </div>
    </div>
  
  <script src="../../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
<script async="" src="https://www.google-analytics.com/analytics.js"></script>
<script>
                        window.ga = window.ga || function () {
                            (ga.q = ga.q || []).push(arguments) };
                        ga.l = +new Date;
                        ga('create', 'UA-188272121-1', 'auto');
                        ga('set', 'anonymizeIp', true);
                        ga('send', 'pageview');
                    </script>
<footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright 2020, Robert Luke.<br/>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.0.2.<br/>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>